
# 命令模式（Command Pattern）

## 概述

**命令模式是一种行为型设计模式，它将一个请求（或操作）封装成一个独立的、可参数化的对象。这个对象包含了执行特定操作所需的所有信息。通过将请求包装成对象，你可以对请求进行参数化、排队、记录、撤销操作，以及支持事务等功能。**

**命令模式的核心思想是：**将“做什么”与“谁来做”分离。

## 角色与协作

**命令模式通常涉及以下四个主要角色：**

* **命令（Command）：**

  * **职责：** **声明一个执行操作的接口。所有具体命令类都必须实现这个接口。通常包含一个** **execute()** **方法。**
  * **特点：** **这是一个抽象接口或抽象类。**
* **具体命令（Concrete Command）：**

  * **职责：** **实现命令接口，封装一个接收者对象和一个或多个对其执行的操作。它将接收者和操作绑定在一起。**
  * **特点：**

    * **持有一个对**接收者**的引用。**
    * **调用接收者的一个或多个方法来执行请求。**
    * **通常在构造时接收并存储接收者。**
* **调用者（Invoker）：**

  * **职责：** **负责发出请求（调用命令）。它持有一个命令对象的引用。**
  * **特点：**

    * **不知道具体命令和接收者是谁，只知道调用命令对象的** **execute()** **方法。**
    * **可以在运行时动态地设置具体命令。**
    * **可以对命令进行排队、记录、撤销等管理操作。**
* **接收者（Receiver）：**

  * **职责：** **执行与请求相关的实际操作。知道如何执行具体操作的细节。**
  * **特点：**

    * **可以是任何类或对象。**
    * **不直接与调用者交互，通过具体命令来接收请求。**

## 工作流程

* **创建具体命令：** **客户端（或更高级别的代码）创建** **接收者** **对象。**
* **绑定操作：** **客户端创建一个或多个** **具体命令** **对象，并将** **接收者** **对象作为参数传递给** **具体命令** **的构造函数，从而将特定的操作绑定到特定的接收者上。**
* **设置调用者：** **客户端将** **具体命令** **对象设置到** **调用者** **对象中。**
* **发出请求：** **调用者** **收到请求后，不直接执行操作，而是调用其持有的** **命令** **对象的** **execute()** **方法。**
* **执行操作：** **具体命令** **的** **execute()** **方法被调用后，它会调用其内部封装的** **接收者** **对象中的具体业务逻辑方法，从而完成请求。**

## 优点

* **解耦（Coupling）：** **将发出请求的对象（调用者）与执行请求的对象（接收者）彻底解耦。调用者不需要知道接收者的具体类型和实现细节。**
* **可扩展性（Extensibility）：** **增加新的命令无需修改现有代码。只需创建新的具体命令类即可。**
* **可排队、记录和撤销（Queue, Log, Undo）：** **容易实现命令的排队、延迟执行、记录日志以及撤销（Undo/Redo）功能。如果命令对象可以存储其执行前的状态，并提供** **unexecute()** **方法，就能实现撤销。**
* **组合命令（Macro Command）：** **可以将多个简单命令组合成一个宏命令，作为一个单独的命令来执行。**
* **降低复杂性：** **通过将请求封装为对象，可以简化复杂操作的管理。**

## 缺点

* **增加类数量：** **对于每一个不同的请求，都需要创建一个具体的命令类，这可能会导致系统中类的数量增多。**
* **引入额外抽象层：** **增加了一层抽象（命令接口和具体命令），可能会在某些非常简单的情况下增加不必要的复杂性。**

## 适用场景

* **需要将操作参数化：** **当需要把操作作为参数传递给方法、存储在数据结构中或在不同时间执行时。**
* **支持撤销/重做功能：** **通过记录命令并提供反向操作，可以轻松实现。**
* **实现请求队列或延迟执行：** **命令可以被存储起来，稍后按顺序执行。**
* **实现宏命令：** **将一系列操作组合成一个单一的命令。**
* **图形用户界面（GUI）：** **按钮、菜单项等可以被抽象为命令，当用户点击时执行。**
* **事务处理：** **将一系列操作封装为命令，要么全部成功，要么全部回滚。**

## 与其他模式的关系

* **策略模式：** **看起来相似，但目的不同。策略模式关注算法族，命令模式关注请求的封装和处理。**
* **备忘录模式：** **通常与命令模式结合使用，用于存储命令执行前的状态，以便实现撤销功能。**
* **责任链模式：** **可以将命令对象沿责任链传递，直到有处理器处理它。**
* **组合模式：** **用于实现宏命令，将多个简单命令组合成一个复合命令。**

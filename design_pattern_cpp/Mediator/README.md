
# 迭代器模式（Iterator Pattern）

## 概述

 **迭代器模式是一种行为型设计模式，它提供了一种**顺序访问聚合对象（如列表、集合、树等）中元素**的方法，而**无需暴露该聚合对象的内部表示**。**

 **简单来说，迭代器模式将遍历（“如何访问”）的责任从聚合对象本身分离出来，封装到一个独立的迭代器对象中。这使得你可以以统一的方式遍历不同类型的聚合结构，并且在遍历过程中，聚合对象的内部结构可以改变而不会影响遍历算法。**

## 角色与协作

**迭代器模式通常涉及以下四个主要角色：**

* **迭代器（Iterator）：**

  * **职责：** **定义访问和遍历聚合对象元素的接口。通常包含以下方法：**

    * **first()** **或** **reset()**：将迭代器重置到聚合的第一个元素。
    * **next()**：移动到下一个元素。
    * **isDone()** **或** **hasNext()**：检查是否已遍历完所有元素。
    * **currentItem()** **或** **get()**：返回当前指向的元素。
  * **特点：** **这是一个抽象接口或抽象类。**
* **具体迭代器（Concrete Iterator）：**

  * **职责：** **实现迭代器接口，负责跟踪它在聚合对象中的当前位置，并根据其内部结构实现具体的遍历算法。**
  * **特点：**

    * **持有一个对它所遍历的**具体聚合对象**的引用。**
    * **知道如何遍历具体聚合的内部数据结构。**
* **聚合（Aggregate）：**

  * **职责：** **定义创建相应迭代器对象的接口。**
  * **特点：** **这是一个抽象接口或抽象类，通常包含一个** **createIterator()** **或** **iterator()** **方法，返回一个迭代器接口的实例。**
* **具体聚合（Concrete Aggregate）：**

  * **职责：** **实现聚合接口，负责存储对象的集合，并实现** **createIterator()** **方法，返回一个与其内部数据结构相匹配的** **具体迭代器** **实例。**
  * **特点：**

    * **包含实际的数据集合。**
    * **知道如何实例化正确的具体迭代器。**

## 工作流程

* **创建聚合：** **客户端代码创建** **具体聚合** **对象（例如，一个列表或数组）。**
* **获取迭代器：** **客户端通过** **具体聚合** **对象的** **createIterator()** **方法获取一个** **具体迭代器** **对象。此时，客户端只与** **迭代器** **接口交互，不知道具体迭代器的实现细节。**
* **开始遍历：** **客户端使用** **迭代器** **接口的方法（如** **first()**, **isDone()**, **next()**, **currentItem()**）来顺序访问聚合中的元素。
* **内部遍历：** **具体迭代器** **在内部根据其所引用的** **具体聚合** **的数据结构（例如，数组的索引，链表的指针）来跟踪当前位置，并提供下一个元素。**

## 优点

* **分离关注点（Separation of Concerns）：** **将遍历逻辑从聚合对象中分离出来，使得聚合对象专注于管理数据，而迭代器专注于遍历。**
* **统一访问（Uniform Access）：** **提供了统一的接口来遍历不同类型的聚合对象，客户端代码无需关心底层聚合的具体实现（是数组、链表、哈希表还是树）。**
* **简化聚合接口：** **聚合对象不需要提供大量的遍历方法（如** **getElementAt(index)**, **getNextNode()** **等），其接口变得更简洁。**
* **支持多种遍历方式：** **可以为同一个聚合对象提供多种不同的迭代器，实现不同的遍历算法（例如，前序遍历、中序遍历、后序遍历、跳过偶数元素等），而无需修改聚合对象本身。**
* **增强复用性：** **迭代器和聚合可以独立变化，互不影响。**
* **安全性：** **不暴露聚合对象的内部结构，客户端无法直接修改聚合的内部状态，从而提高数据安全性。**

## 缺点

* **增加类数量：** **对于每个聚合类型，通常需要一个抽象迭代器和一个具体迭代器，这会增加系统的类数量。**
* **在简单情况下可能引入不必要的复杂性：** **对于非常简单的聚合（如只有几个元素的数组），引入迭代器模式可能显得过度设计。**

## 适用场景

* **当需要访问一个聚合对象的内容，而又不想暴露其内部表示时。**
* **当需要为聚合对象提供多种不同的遍历方式时。**
* **当需要为聚合对象提供一个统一的遍历接口，以支持客户端代码泛型化时。**
* **当聚合对象的内部结构可能经常变化，但不希望因此改变遍历代码时。**
* **实现标准库容器（如 C++ 的** **std::vector**, **std::list** **等）的遍历机制。**
* **数据库查询结果集的遍历。**

## 与其他模式的关系

* **组合模式：** **迭代器模式经常与组合模式一起使用，用于遍历组合结构（例如树形结构）中的元素。**
* **工厂方法模式：** **createIterator()** **方法本质上就是一个工厂方法，用于创建具体迭代器实例。**
* **访问者模式：** **迭代器模式负责遍历结构，访问者模式负责对遍历到的元素执行操作。它们可以协同工作。**
